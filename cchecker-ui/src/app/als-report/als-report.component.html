<h2>
   Medidata RAVE ALS Report
</h2>
<div class="alert alert-danger" role="alert" *ngIf="loaded && !reportData.cccForms.length">
   Please select forms and try again.
</div>

<div class="alert alert-danger" role="alert" *ngIf="errorMessage" [innerHTML]="errorMessage">
</div>

<div class="alert alert-success" role="alert" *ngIf="statusMessage">
   {{statusMessage}}
</div>

<div *ngIf="!loaded">
   <app-progress-bar [statusMessage]="'Loading Report'" [type]="'busy'" [percentage]="100"></app-progress-bar>
</div>

<form #f="ngForm">

   <div>
      <div *ngIf="isGenerating">
         <app-progress-bar [statusMessage]="'Generating Excel Report'" [type]="'busy'" [percentage]="100"></app-progress-bar><br />
      </div>      
      <span class="reportHeader">
      <button class="btn btn-primary" [disabled]="isGenerating" (click)="generateExcel()" *ngIf="reportData['cccForms'].length">Generate Excel</button>
      </span>
      <span class="reportHeader" [hidden]="!reportData.cccForms.length">
         <label for="raveFormOid">Rave Form</label>
         <select name="raveForm" id="raveFormOid" ngModel (change)="changeForm(f.value.raveForm,0)"  #localRaveOid>
         <option value="" disabled>Select a form</option>
         <option *ngFor="let form of reportData['cccForms'] | formListsort:'raveFormOid'" [ngValue]="form">
         {{form.formName}}
         </option>
         </select>
      </span>
   </div>
   <br />
   <ngb-tabset type="pills" ([ngModel])="tabs" #tabs>
   <ngb-tab title="Summary" *ngIf="reportData.cccForms.length">
      <ng-template ngbTabContent>
         <table datatable [dtOptions]="dtSummaryOptions" class="display compact" [hidden]="!reportData.cccForms.length" *ngIf="reportData as r">
         <thead>
            <tr>
               <th>CDE Congruency Checker Report for {{r.reportOwner}}</th>
               <th></th>
            </tr>
         </thead>
         <tbody>
            <tr>
               <td>Rave Protocol name </td>
               <td>{{r.raveProtocolName}}</td>
            </tr>
            <tr>
               <td>Rave Protocol number </td>
               <td>{{r.raveProtocolNumber}}</td>
            </tr>
            <tr>
               <td>Date Validated </td>
               <td>{{r.reportDate}}</td>
            </tr>
            <tr>
               <td># Forms in protocol </td>
               <td>{{r.totalFormsCount}}</td>
            </tr>
            <tr>
               <td># Total Questions Checked </td>
               <td>{{r.countQuestionsChecked}}</td>
            </tr>
            <tr>
               <td># Total Questions Congruent </td>
               <td>{{r.countCongruentQuestions}}</td>
            </tr>
            <tr>
               <td># Total Questions with Warnings </td>
               <td>{{r.countQuestionsWithWarnings}}</td>
            </tr>
            <tr>
               <td># Total Questions with Errors </td>
               <td>{{r.countQuestionsWithErrors}}</td>
            </tr>
            <tr>
               <td># Total Questions without associated CDE </td>
               <td>{{r.countQuestionsWithoutCde}}</td>
            </tr>
            <tr>
               <td># Required NRDS Questions missing  </td>
               <td>{{r.countNrdsMissing}}</td>
            </tr>
            <tr>
               <td># Required NRDS Questions Congruent </td>
               <td>{{r.countNrdsCongruent}}</td>
            </tr>
            <tr>
               <td># Required NRDS Questions With Warnings </td>
               <td>{{r.countNrdsWithWarnings}}</td>
            </tr>
            <tr>
               <td># Required NRDS Questions With Errors </td>
               <td>{{r.countNrdsWithErrors}}</td>
            </tr>
            <tr>
               <td># CDISC/CDASH 2.0 CDEs Classified missing </td>
               <td>{{r.countCdashMissing}}</td>
            </tr>
            <tr>
               <td># CDISC/SDTM 3.3 CDEs Classified missing </td>
               <td>{{r.countSdtmMissing}}</td>
            </tr>
            <tr>
               <td># NCI Standard Template Mandatory Modules Questions missing from Protocol  </td>
               <td>{{r.countManCrfMissing}}</td>
            </tr>
            <tr>
               <td># NCI Standard Template Mandatory Modules Questions Congruent </td>
               <td>{{r.countManCrfCongruent}}</td>
            </tr>
            <tr>
               <td># NCI Standard Template Mandatory Modules Questions With Errors </td>
               <td>{{r.countManCrfWithErrors}}</td>
            </tr>
            <tr>
               <td># NCI Standard Template Mandatory Modules Questions With Warnings </td>
               <td>{{r.countManCrfwWithWarnings}}</td>
            </tr>
            <tr>
               <td># NCI Standard Template Conditional Modules Questions missing from Protocol </td>
               <td>{{r.countCondCrfMissing}}</td>
            </tr>
            <tr>
               <td># NCI Standard Template Conditional Modules Questions Congruent </td>
               <td>{{r.countCondCrfCongruent}}</td>
            </tr>
            <tr>
               <td># NCI Standard Template Conditional Modules Questions With Errors </td>
               <td>{{r.countCondCrfWithErrors}}</td>
            </tr>
            <tr>
               <td># NCI Standard Template Conditional Modules Questions With Warnings </td>
               <td>{{r.countCondCrfwWithWarnings}}</td>
            </tr>
            <tr>
               <td># NCI Standard Template Optional Modules Questions missing from Protocol  </td>
               <td>{{r.countOptCrfMissing}}</td>
            </tr>
            <tr>
               <td># NCI Standard Template Optional Modules Questions Congruent </td>
               <td>{{r.countCondCrfCongruent}}</td>
            </tr>
            <tr>
               <td># NCI Standard Template Optional Modules Questions With Errors </td>
               <td>{{r.countOptCrfWithErrors}}</td>
            </tr>
            <tr>
               <td># NCI Standard Template Optional Modules Questions With Warnings </td>
               <td>{{r.countOptCrfwWithWarnings}}</td>
            </tr>

            
         </tbody>
         </table>
         <br />
        <div class="tableHeader" [hidden]="!reportData.cccForms.length">
            Report Summary - Click on Form Name to expand results
        </div>
        <table datatable [dtOptions]="dtSummaryOptions" class="display compact" *ngIf="reportData as r" [hidden]="!reportData.cccForms.length">
            <thead>
                <tr>
                    <th>Form</th>
                    <th>Validation Result</th>
                </tr>
            </thead>      
            <tbody>
                <tr *ngFor="let form of r.cccForms">
                    <td><a href="#" name="form" (click)="changeForm(form,f)">{{form.formName}}</a></td>
                    <td>{{form.congruencyStatus}}</td>
                </tr>
            </tbody>                
        </table>  
      </ng-template>
   </ngb-tab>
   <ngb-tab *ngIf="reportData.cccForms.length">
       <ng-template ngbTabTitle>NRDS CDEs in ALS</ng-template>
       <ng-template ngbTabContent>
         <div class="tableHeader">NRDS CDEs included in Protocol Forms with Warnings or Errors</div>

        <table datatable [dtOptions]="dtNrdsOptions" class="display compact">
            <tbody>
                <tr *ngFor="let missingNrds of reportData.nrdsCdeList">
                    <td>{{missingNrds.raveFormOid}}</td>
                    <td>{{missingNrds.raveFieldOrder}}</td>
                    <td>{{missingNrds.raveFieldLabel}}</td>
                    <td>{{missingNrds.cdeIdVersion}}</td>
                    <td>{{missingNrds.cdeName}}</td>
                    <td>{{missingNrds.result}}</td>
                    <td>{{missingNrds.message}}</td>
                </tr>
            </tbody>            
        </table>        
       </ng-template>
   </ngb-tab>
   <ngb-tab *ngIf="reportData.cccForms.length">
       <ng-template ngbTabTitle>NRDS CDEs Missing</ng-template>
       <ng-template ngbTabContent>
         <div class="tableHeader">NRDS CDEs missing from the ALS file</div>

        <table datatable [dtOptions]="dtNrdsOptionsMissing" class="display compact">
            <tbody>
                <tr *ngFor="let missingNrds of reportData.missingNrdsCdeList">
                    <td>{{missingNrds.cdeIdVersion}}</td>
                    <td>{{missingNrds.cdeName}}</td>
                </tr>
            </tbody>            
        </table>
       </ng-template>
   </ngb-tab>
   <ngb-tab *ngIf="reportData.cccForms.length">
       <ng-template ngbTabTitle>CDISC/CDASH 2.0 CDEs Missing</ng-template>
       <ng-template ngbTabContent>
         <div class="tableHeader">CDISC/CDASH 2.0 CDEs missing from the ALS file</div>

        <table datatable [dtOptions]="dtNrdsOptionsMissing" class="display compact">
            <tbody>
                <tr *ngFor="let missingCdashs of reportData.missingCdashCdeList">
                    <td>{{missingCdashs.cdeIdVersion}}</td>
                    <td>{{missingCdashs.cdeName}}</td>
                </tr>
            </tbody>
        </table>
       </ng-template>
   </ngb-tab>
   <ngb-tab *ngIf="reportData.cccForms.length">
       <ng-template ngbTabTitle>CDISC/SDTM 3.3 CDEs Missing</ng-template>
       <ng-template ngbTabContent>
         <div class="tableHeader">CDISC/SDTM 3.3 CDEs missing from the ALS file</div>

        <table datatable [dtOptions]="dtNrdsOptionsMissing" class="display compact">
            <tbody>
                <tr *ngFor="let missingSdtms of reportData.missingSdtmCdeList">
                    <td>{{missingSdtms.cdeIdVersion}}</td>
                    <td>{{missingSdtms.cdeName}}</td>
                </tr>
            </tbody>
        </table>
       </ng-template>
   </ngb-tab>
   <ngb-tab *ngIf="reportData.isCheckStdCrfCdeChecked">
       <ng-template ngbTabTitle>Standard CRF Mandatory Missing</ng-template>
       <ng-template ngbTabContent>
           <div class="tableHeader">CDEs in Standard Template "Mandatory" Modules Not Used</div>
            <table datatable [dtOptions]="dtCrfOptions" class="display compact">
                <tbody>
                    <tr *ngFor="let missing of reportData.missingStandardCrfCdeList | reportFilter: 'stdTemplateType':'Mandatory'">
                        <td>{{missing.cdeIdVersion}}</td>
                        <td>{{missing.cdeName}}</td>
                        <td>{{missing.templateName}}</td>
                        <td>{{missing.idVersion}}</td>
                    </tr>
                </tbody>
            </table>           
       </ng-template>
   </ngb-tab>
   <ngb-tab *ngIf="reportData.isCheckStdCrfCdeChecked">
       <ng-template ngbTabTitle>Standard CRF Optional Missing</ng-template>
       <ng-template ngbTabContent>
           <div class="tableHeader">CDEs in Standard Template "Optional" Modules Not Used</div>
            <table datatable [dtOptions]="dtCrfOptions" class="display compact">
                <tbody>
                    <tr *ngFor="let missing of reportData.missingStandardCrfCdeList | reportFilter: 'stdTemplateType':'Optional'">
                        <td>{{missing.cdeIdVersion}}</td>
                        <td>{{missing.cdeName}}</td>
                        <td>{{missing.templateName}}</td>
                        <td>{{missing.idVersion}}</td>
                    </tr>
                </tbody>
            </table>              
       </ng-template>
   </ngb-tab>   
   <ngb-tab *ngIf="reportData.isCheckStdCrfCdeChecked">
       <ng-template ngbTabTitle>Standard CRF Conditional Missing</ng-template>
       <ng-template ngbTabContent>
           <div class="tableHeader">CDEs in Standard Template "Conditional" Modules Not Used</div>
            <table datatable [dtOptions]="dtCrfOptions" class="display compact">
                <tbody>
                    <tr *ngFor="let missing of reportData.missingStandardCrfCdeList | reportFilter: 'stdTemplateType':'Conditional'">
                        <td>{{missing.cdeIdVersion}}</td>
                        <td>{{missing.cdeName}}</td>
                        <td>{{missing.templateName}}</td>
                        <td>{{missing.idVersion}}</td>
                    </tr>
                </tbody>
            </table>            
       </ng-template>
   </ngb-tab>      

   <ngb-tab id="raveForm" *ngIf="showFormTab">
      <ng-template ngbTabTitle>{{tabName}}</ng-template>
      <ng-template ngbTabContent>
         <div><B>VIEW OF EXPANDED RESULTS {{raveForm.formName}}</B></div>
         <table datatable [dtOptions]="dtFormSummaryOptions" class="display compact">
            <tbody>
               <tr>
                  <th>Rave Form OID</th>
                  <td>{{raveForm.raveFormOid}}</td>
               </tr>
               <tr>
                  <th>caDSR Form ID</th>
                  <td>{{raveForm.formPublicId}}</td>
               </tr>
               <tr>
                  <th>Version</th>
                  <td>{{raveForm.formVersion}}</td>
               </tr>
               <tr>
                  <th>Total Number of Questions Checked</th>
                  <td>{{raveForm.totalQuestionsChecked}}</td>
               </tr>
            </tbody>
         </table>
         <br />
         <table datatable [dtOptions]="dtFormOptions" [dtTrigger]="dtTrigger" class="display compact">
            <thead>
               <tr>
                  <th>Field Order</th>
                  <th>CDE Public ID</th>
                  <th>CDE Version</th>
                  <th>NCI Category</th>
                  <th>Question Congruency Status</th>
                  <th>Message</th>
                  <th>Rave Field Label</th>
                  <th>Rave Field Label Result</th>
                  <th>CDE Permitted Question Text Choices</th>
                  <th>Rave Control Type</th>
                  <th>Control Type Checker Result</th>
                  <th>CDE Value Domain Type</th>
                  <th>Rave Coded Data</th>
                  <th>Coded Data Result</th>
                  <th>Allowable CDE Value</th>
                  <th>Rave User String</th>
                  <th>PV  Result</th>
                  <th>Allowable CDE  Value Meaning Text Choices</th>
                  <th>Rave Field Data Type</th>
                  <th>Data Type Checker Result</th>
                  <th>CDE Data Type</th>
                  <th>Rave UOM</th>
                  <th>UOM Checker Result</th>
                  <th>CDE UOM</th>
                  <th>Rave Length</th>
                  <th>Length Checker Result</th>
                  <th>CDE Maximum Length</th>
                  <th>Rave Display Format</th>
                  <th>Format Checker Result</th>
                  <th>CDE Display Format</th>
               </tr>
            </thead>
            <tbody>
               <tr *ngFor="let question of raveForm.questions">
                  <td>{{question.fieldOrder}}</td>
                  <td>{{question.cdePublicId}}</td>
                  <td>{{question.cdeVersion}}</td>
                  <td>{{question.nciCategory}}</td>
                  <td>{{question.questionCongruencyStatus}}</td>
                  <td>{{question.message}}</td>
                  <td>{{question.raveFieldLabel}}</td>
                  <td>{{question.raveFieldLabelResult}}</td>
                  <td>{{question.cdePermitQuestionTextChoices}}</td>
                  <td>{{question.raveControlType}}</td>
                  <td>{{question.controlTypeResult}}</td>
                  <td>{{question.cdeValueDomainType}}</td>
                  <td><span *ngFor="let line of question.raveCodedData">{{line}}<br /></span></td>
                  <td><span *ngFor="let line of question.codedDataResult">{{line}}<br /></span></td>
                  <td style="max-width:300px;word-wrap:break-word">{{question.allowableCdeValue}}</td>
                  <td><span *ngFor="let line of question.raveUserString">{{line}}<br /></span></td>
                  <td><span *ngFor="let line of question.pvResults">{{line}}<br /></span></td>
                  <td><span *ngFor="let line of question.allowableCdeTextChoices">{{line}}<br /></span></td>
                  <!-- <td><span *ngFor="let line of question.codedDataResult">{{line}}<br /></span></td>
                  <td>{{question.allowableCdeValue}}</td>
                  <td><span *ngFor="let line of question.raveUserString">{{line}}<br /></span></td>
                  <td><span *ngFor="let line of question.pvResults">{{line}}<br /></span></td>
                  <td><span *ngFor="let line of question.allowableCdeTextChoices">{{line}}<br /></span></td> -->
                  <td>{{question.raveFieldDataType}}</td>
                  <td>{{question.datatypeCheckerResult}}</td>
                  <td>{{question.cdeDataType}}</td>
                  <td>{{question.raveUOM}}</td>
                  <td>{{question.uomCheckerResult}}</td>
                  <td>{{question.cdeUOM}}</td>
                  <td>{{question.raveLength}}</td>
                  <td>{{question.lengthCheckerResult}}</td>
                  <td>{{question.cdeMaxLength}}</td>
                  <td>{{question.raveDisplayFormat}}</td>
                  <td>{{question.formatCheckerResult}}</td>
                  <td>{{question.cdeDisplayFormat}}</td>
               </tr>
            </tbody>
         </table>
      </ng-template>
   </ngb-tab>
   </ngb-tabset>
</form>

